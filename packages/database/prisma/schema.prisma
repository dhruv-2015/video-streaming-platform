// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
  binaryTargets   = ["native", "debian-openssl-1.1.x"]
  output          = "../generated/client"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id                   String                 @id @default(auto()) @map("_id") @db.ObjectId
  email                String                 @unique
  name                 String
  role                 Role                   @default(USER)
  image                S3File?
  channel_id           String?                @map("channel_id") @db.ObjectId
  // Channel              Channel                @relation(fields: [channel_id], references: [id])
  Channel              Channel?
  updatedAt            DateTime               @updatedAt
  createdAt            DateTime               @default(now())
  VideoView            VideoView[]            
  VideoLike            VideoLike[]
  VideoDissLike        VideoDissLike[]        @ignore
  ChannelView          ChannelView[]          @ignore
  VideoComment         VideoComment[]         @ignore
  VideoCommentLike     VideoCommentLike[]     @ignore
  VideoCommentDissLike VideoCommentDissLike[] @ignore
  WatchHistory         WatchHistory[]
  Playlist             Playlist[]
  WarchLater           WarchLaterVideo[]
  ChannelSubscription  ChannelSubscription[]
}

model deletedChannel {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  channel_id       String   @db.ObjectId
  user_id          String   @db.ObjectId
  slug             String
  name             String
  description      String
  subscriber_count Int
  total_views      Int
  createdAt        DateTime
  updatedAt        DateTime
  deletedAt        DateTime @default(now())
}

model Channel {
  id                  String                @id @default(auto()) @map("_id") @db.ObjectId
  user_id             String                @unique @db.ObjectId
  User                User                  @relation(fields: [user_id], references: [id])
  // User                User                  @relation(fields: [userId], references: [id])
  slug                String                @unique
  image               S3File?
  thumbnail           S3File?
  name                String
  description         String                @default("")
  subscriber_count    Int                   @default(0)
  total_views         Int                   @default(0)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  Videos              Video[]
  ChannelSubscription ChannelSubscription[]
  ChannelView         ChannelView[]         @ignore

  @@index(fields: [name], map: "name_index")
}

model TempFileUpload {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  key       String
  bucket    String
  expires   DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

type S3File {
  key       String
  bucket    String
  createdAt DateTime @default(now())
}

enum VideoType {
  PUBLIC
  PRIVATE
  UNLISTED
}

model Video {
  id                 String            @id @default(auto()) @map("_id") @db.ObjectId
  channel_id         String            @db.ObjectId
  channel            Channel           @relation(fields: [channel_id], references: [id])
  is_ready           Boolean           @default(false)
  is_deleted         Boolean           @default(false)
  delete_reason      String?
  is_banned          Boolean           @default(false)
  banned_reason      String?
  error_message      String?
  title              String
  description        String            @default("")
  thumbnail          S3File?
  avalable_thumbnail S3File[]
  view_count         BigInt            @default(0)
  like_count         BigInt            @default(0)
  dislike_count      BigInt            @default(0)
  video_type         VideoType         @default(PUBLIC)
  is_published       Boolean           @default(false)
  published_at       DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  orignal_file       S3File?
  is_uploaded        Boolean           @default(false)
  VideoFile          VideoFile?
  VideoView          VideoView[]       
  VideoLike          VideoLike[]
  VideoDissLike      VideoDissLike[]
  VideoComment       VideoComment[]
  video_tags_id      String[]          @db.ObjectId
  VideoTags          VideoTags[]       @relation(fields: [video_tags_id], references: [id])
  WatchHistory       WatchHistory[]    
  WarchLaterVideo    WarchLaterVideo[] 
  PlaylistVideo      PlaylistVideo[]
  VideoTranscoding   VideoTranscoding?
}

type VideoSubTitle {
  language  String
  url       S3File
  label     String
  type      String
  default   Boolean  @default(false)
  createdAt DateTime @default(now())
}

type IndividualVideoTracks {
  url       S3File
  hight     Int
  width     Int
  bitrate   Int
  codec     String
  duration  Int
  createdAt DateTime @default(now())
}

type IndividualAudioTracks {
  url       S3File
  language  String
  label     String
  channels  Int
  codec     String
  bitrate   Int
  duration  Int
  createdAt DateTime @default(now())
}

type VideoStoryboard {
  vtt       S3File
  image     S3File
  createdAt DateTime @default(now())
}

model VideoTranscoding {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  video_id  String   @unique @db.ObjectId
  Video     Video    @relation(fields: [video_id], references: [id])
  status    String
  message   String?
  job_id    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VideoFile {
  id                    String                  @id @default(auto()) @map("_id") @db.ObjectId
  video_id              String                  @unique @db.ObjectId
  Video                 Video                   @relation(fields: [video_id], references: [id])
  audio_channels        Int
  subtitle_channels     Int
  duration              Int
  subtitle              VideoSubTitle[]
  storyboard            VideoStoryboard
  m3u8                  S3File
  IndividualVideoTracks IndividualVideoTracks[]
  IndividualAudioTracks IndividualAudioTracks[]
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
}

model VideoView {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  video_id String @db.ObjectId
  Video    Video  @relation(fields: [video_id], references: [id])
  user_id  String @db.ObjectId
  User     User   @relation(fields: [user_id], references: [id])

  @@unique([video_id, user_id])
}

model VideoLike {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  video_id   String   @db.ObjectId
  Video      Video    @relation(fields: [video_id], references: [id])
  user_id    String   @db.ObjectId
  User       User     @relation(fields: [user_id], references: [id])
  assignedAt DateTime @default(now())

  @@unique([video_id, user_id])
}

model VideoDissLike {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  video_id   String   @db.ObjectId
  Video      Video    @relation(fields: [video_id], references: [id])
  user_id    String   @db.ObjectId
  User       User     @relation(fields: [user_id], references: [id])
  assignedAt DateTime @default(now())

  @@unique([video_id, user_id])
}

model ChannelSubscription {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  channel_id String   @db.ObjectId
  Channel    Channel  @relation(fields: [channel_id], references: [id])
  user_id    String   @db.ObjectId
  User       User     @relation(fields: [user_id], references: [id])
  assignedAt DateTime @default(now())

  @@unique([channel_id, user_id])
}

model ChannelView {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  channel_id String   @db.ObjectId
  Channel    Channel  @relation(fields: [channel_id], references: [id])
  user_id    String   @db.ObjectId
  User       User     @relation(fields: [user_id], references: [id])
  assignedAt DateTime @default(now())

  @@unique([channel_id, user_id])
}

model VideoComment {
  id                   String                 @id @default(auto()) @map("_id") @db.ObjectId
  video_id             String                 @db.ObjectId
  Video                Video                  @relation(fields: [video_id], references: [id])
  user_id              String                 @db.ObjectId
  User                 User                   @relation(fields: [user_id], references: [id])
  parent_id            String?                @db.ObjectId
  Parent               VideoComment?          @relation("CommentParent", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  is_deleted           Boolean                @default(false)
  is_edited            Boolean                @default(false)
  total_reply          Int                    @default(0)
  text                 String
  createdAt            DateTime               @default(now())
  like_count           Int                    @default(0)
  dislike_count        Int                    @default(0)
  updatedAt            DateTime               @updatedAt
  VideoComment         VideoComment[]         @relation("CommentParent") @ignore
  VideoCommentLike     VideoCommentLike[]
  VideoCommentDissLike VideoCommentDissLike[]

  @@unique([video_id, user_id])
}

model VideoCommentLike {
  id         String       @id @default(auto()) @map("_id") @db.ObjectId
  comment_id String       @db.ObjectId
  Comment    VideoComment @relation(fields: [comment_id], references: [id])
  user_id    String       @db.ObjectId
  video_id   String       @db.ObjectId
  User       User         @relation(fields: [user_id], references: [id])
  assignedAt DateTime     @default(now())

  @@unique([comment_id, user_id])
}

model VideoCommentDissLike {
  id         String       @id @default(auto()) @map("_id") @db.ObjectId
  comment_id String       @db.ObjectId
  Comment    VideoComment @relation(fields: [comment_id], references: [id])
  user_id    String       @db.ObjectId
  video_id   String       @db.ObjectId
  User       User         @relation(fields: [user_id], references: [id])
  assignedAt DateTime     @default(now())

  @@unique([comment_id, user_id])
}

// model Tags {
//   id        String      @id @default(auto()) @map("_id") @db.ObjectId
//   name      String      @unique
//   createdAt DateTime    @default(now())
//   updatedAt DateTime    @updatedAt
//   VideoTags VideoTags[] @ignore
// }

model VideoTags {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  tag       String   @unique
  video_id  String[] @db.ObjectId
  Video     Video[]  @relation(fields: [video_id], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WatchHistory {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  user_id   String   @db.ObjectId
  User      User     @relation(fields: [user_id], references: [id])
  video_id  String   @db.ObjectId
  Video     Video    @relation(fields: [video_id], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([user_id, video_id])
}

model WarchLaterVideo {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  user_id   String   @db.ObjectId
  User      User     @relation(fields: [user_id], references: [id])
  video_id  String   @db.ObjectId
  Video     Video    @relation(fields: [video_id], references: [id])
  index     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([user_id, video_id])
  @@index([user_id, index])
  @@map("WarchLater")
}

model Playlist {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  creater_id    String          @db.ObjectId
  creater       User            @relation(fields: [creater_id], references: [id])
  name          String
  description   String          @default("")
  is_private    Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  PlaylistVideo PlaylistVideo[]
}

model PlaylistVideo {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  playlist_id String   @db.ObjectId
  playlist    Playlist @relation(fields: [playlist_id], references: [id])
  video_id    String   @db.ObjectId
  video       Video    @relation(fields: [video_id], references: [id])
  index       Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([playlist_id, video_id])
}
